# Astradraw - Self-hosted Excalidraw Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# DOCKER SECRETS SUPPORT
# =============================================================================
# All sensitive configuration supports Docker secrets via the _FILE suffix.
# Instead of setting a value directly (e.g., JWT_SECRET=mysecret), you can:
#   1. Create a file with the secret value: echo "mysecret" > secrets/jwt_secret
#   2. Point to it via _FILE suffix: JWT_SECRET_FILE=/run/secrets/jwt_secret
#
# The backend will automatically read the file contents when _FILE is set.
# This is more secure than environment variables for production deployments.
#
# Example secrets directory structure:
#   deploy/secrets/
#   ├── postgres_user          # Database username
#   ├── postgres_password      # Database password
#   ├── postgres_db            # Database name
#   ├── jwt_secret             # JWT signing key
#   ├── oidc_client_secret     # OIDC client secret
#   ├── superadmin_emails      # Comma-separated admin emails
#   ├── admin_password         # Default admin password
#   ├── minio_access_key       # MinIO access key
#   ├── minio_secret_key       # MinIO secret key
#   ├── kinescope_api_key      # Kinescope API key
#   └── kinescope_project_id   # Kinescope project ID
#
# Quick setup:
#   mkdir -p secrets
#   echo "excalidraw" > secrets/postgres_user
#   openssl rand -base64 32 > secrets/postgres_password
#   echo "excalidraw" > secrets/postgres_db
#   openssl rand -base64 32 > secrets/jwt_secret
#   echo "minioadmin" > secrets/minio_access_key
#   openssl rand -base64 32 > secrets/minio_secret_key

# =============================================================================
# DOMAIN CONFIGURATION
# =============================================================================

# Your domain for Excalidraw (e.g., draw.example.com or IP address)
APP_DOMAIN=localhost

# Protocol to use (http or https)
# Use 'http' for local testing, 'https' for production with SSL
APP_PROTOCOL=http

# Email for Let's Encrypt certificates (uncomment when using HTTPS)
# ACME_EMAIL=your-email@example.com

# =============================================================================
# STORAGE BACKEND CONFIGURATION
# =============================================================================

# Storage backend type: 's3' (MinIO/S3) or 'keyv' (PostgreSQL/MongoDB)
# Recommended: s3 for blob storage (scenes, rooms, files)
STORAGE_BACKEND=s3

# =============================================================================
# S3/MINIO CONFIGURATION (when STORAGE_BACKEND=s3)
# =============================================================================

# S3 endpoint URL (default: http://minio:9000 for local MinIO)
# For AWS S3: https://s3.amazonaws.com
# For external MinIO: http://your-minio-host:9000
S3_ENDPOINT=http://minio:9000

# S3 bucket name for storing scenes, rooms, and files
S3_BUCKET=excalidraw

# S3 region (can be any value for MinIO)
S3_REGION=us-east-1

# Force path-style URLs (required for MinIO, set to false for AWS S3)
S3_FORCE_PATH_STYLE=true

# Public URL for S3 thumbnails (optional, for production with CDN)
# If not set, thumbnails use /s3/ path proxied via Traefik
# S3_PUBLIC_URL=https://s3.example.com

# MinIO credentials - use secrets (recommended):
#   echo "minioadmin" > secrets/minio_access_key
#   openssl rand -base64 32 > secrets/minio_secret_key
#
# Or set directly (less secure):
# S3_ACCESS_KEY=minioadmin
# S3_SECRET_KEY=your_minio_secret_key

# =============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# =============================================================================
# PostgreSQL is used for user management, workspaces, scenes metadata, etc.
#
# Option 1: Use Docker secrets (RECOMMENDED for production)
# Create secret files and the backend will read them automatically:
#   echo "excalidraw" > secrets/postgres_user
#   openssl rand -base64 32 > secrets/postgres_password
#   echo "excalidraw" > secrets/postgres_db
#
# Option 2: Set values directly in .env (less secure)
POSTGRES_USER=excalidraw
POSTGRES_PASSWORD=your_secure_postgres_password
POSTGRES_DB=excalidraw

# For external PostgreSQL (outside Docker), set host and port:
# POSTGRES_HOST=10.1.125.55
# POSTGRES_PORT=5000
#
# Then run without the built-in postgres:
#   docker compose up -d --scale postgres=0

# Option 3: Use DATABASE_URL directly (supports _FILE suffix)
# DATABASE_URL=postgresql://user:password@host:5432/database?schema=public
# Or: echo "postgresql://..." > secrets/database_url

# pgAdmin (database admin UI) - only used with --profile admin
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=your_admin_password

# =============================================================================
# AUTHENTICATION - JWT SECRET
# =============================================================================
# Secret key for signing JWT tokens. MUST be changed in production!
#
# Generate a secure secret:
#   openssl rand -base64 32
#
# Option 1: Use Docker secret (recommended):
#   openssl rand -base64 32 > secrets/jwt_secret
#
# Option 2: Set directly (less secure):
JWT_SECRET=change-me-in-production

# =============================================================================
# AUTHENTICATION - OIDC (Authentik, Keycloak, etc.)
# =============================================================================
# Configure OIDC for user authentication with any OIDC provider.
# All settings support _FILE suffix for Docker secrets.

# OIDC Issuer URL (your identity provider URL)
# Example: https://auth.yourdomain.com/application/o/astradraw/
OIDC_ISSUER_URL=

# OIDC Client ID (from your identity provider)
OIDC_CLIENT_ID=

# OIDC Client Secret - use secret file for production:
#   echo "your_client_secret" > secrets/oidc_client_secret
# Or set directly (less secure):
OIDC_CLIENT_SECRET=

# Internal URL for OIDC discovery (for Docker networking)
# Use this when your OIDC provider is in the same Docker network
# Example: http://dex:5556/dex
OIDC_INTERNAL_URL=

# =============================================================================
# DEX OIDC PROVIDER (for testing)
# =============================================================================
# A lightweight OIDC provider is included for testing OAuth flows.
# Start it with: docker compose --profile oidc up -d
#
# Test users (defined in dex-config.yaml):
#   - admin@example.com / admin123
#   - user@example.com / user123
#
# To use Dex for testing, set these values:
# OIDC_ISSUER_URL=https://auth.${APP_DOMAIN}/dex
# OIDC_CLIENT_ID=astradraw
# OIDC_CLIENT_SECRET=astradraw-secret-change-in-production
# OIDC_INTERNAL_URL=http://dex:5556/dex
#
# Make sure to update dex-config.yaml with your APP_DOMAIN!

# =============================================================================
# LOCAL AUTHENTICATION (Default Admin User)
# =============================================================================
# When OIDC is not configured, local authentication is enabled by default.
# All settings support _FILE suffix for Docker secrets.

# Enable/disable local authentication (default: true when OIDC not configured)
ENABLE_LOCAL_AUTH=true

# Enable/disable user registration (default: false)
ENABLE_REGISTRATION=false

# Admin username (default: admin)
ADMIN_USERNAME=admin

# Admin password - use secret file for production:
#   echo "secure_password" > secrets/admin_password
# Or set directly (CHANGE THIS IN PRODUCTION!):
ADMIN_PASSWORD=admin

# Admin email (default: admin@localhost)
ADMIN_EMAIL=admin@localhost

# =============================================================================
# SUPER ADMIN CONFIGURATION
# =============================================================================
# Super admins have instance-level management capabilities:
# - Can create and delete workspaces
# - Can assign workspace admins
# - Can configure instance settings
#
# Comma-separated list of email addresses that should be super admins.
# Users with these emails will be automatically promoted on login.
#
# Use Docker secret for production:
#   echo "admin@example.com,boss@example.com" > secrets/superadmin_emails
#
# Or set directly:
SUPERADMIN_EMAILS=admin@localhost

# =============================================================================
# GIPHY CONFIGURATION (for Stickers & GIFs sidebar)
# =============================================================================
# GIPHY API Key for GIF/sticker search functionality
# Get your free API key at: https://developers.giphy.com/
#
# Use Docker secret:
#   echo "your_api_key" > secrets/giphy_api_key
#
# Or set directly:
GIPHY_API_KEY=your_giphy_api_key_here

# =============================================================================
# KINESCOPE CONFIGURATION (for Talktrack board recordings)
# =============================================================================
# Kinescope API Key for video upload and playback
# Get your API key at: https://app.kinescope.io/
#
# SECURITY: These credentials are used ONLY by the backend service.
# The frontend proxies all requests through the backend.
#
# Use Docker secrets (recommended):
#   echo "your_api_key" > secrets/kinescope_api_key
#   echo "your_project_id" > secrets/kinescope_project_id
#
# Or set directly:
KINESCOPE_API_KEY=your_kinescope_api_key_here
KINESCOPE_PROJECT_ID=your_project_id_here

# =============================================================================
# DEBUG CONFIGURATION (Navigation Logging)
# =============================================================================
# Enable navigation debugging to troubleshoot scene switching issues.
# When enabled, navigation events are logged to deploy/logs/navigation.log
#
# WARNING: Debug logging may impact performance. Disable in production.
DEBUG_NAVIGATION=false

# =============================================================================
# OPTIONAL CONFIGURATION
# =============================================================================

# Storage backend log level (debug, verbose, log, warn, error)
# STORAGE_LOG_LEVEL=warn

# Maximum payload size for scenes/images
# STORAGE_BODY_LIMIT=50mb

# Room key secret for collaboration encryption (defaults to JWT_SECRET)
# ROOM_KEY_SECRET=your_room_key_secret
