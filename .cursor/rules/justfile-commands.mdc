---
description: "Use Justfile commands instead of writing full shell commands"
alwaysApply: true
---

# Justfile Commands

This project uses [just](https://github.com/casey/just) for common commands. **Always prefer `just` commands over writing full shell commands.**

## Deployment Modes

AstraDraw supports two deployment modes:

| Mode | Description | Command |
|------|-------------|---------|
| **Production** | Uses pre-built images from GHCR | `just up` |
| **Development** | Builds from local source code | `just up-dev` |

Check current mode: `just mode`

### Switching Modes

```bash
just enable-dev    # Enable local builds (creates override file)
just disable-dev   # Use production images (removes override file)
```

## Quick Reference

### Docker - Production Images

| Command | Description |
|---------|-------------|
| `just up` | Start with GHCR images |
| `just up-prod` | Force production images (ignores override) |
| `just fresh` | Fresh start with production images |
| `just pull` | Pull latest production images |

### Docker - Local Builds

| Command | Description |
|---------|-------------|
| `just up-dev` | Start with local builds |
| `just fresh-dev` | Fresh start with local builds |
| `just build` | Build local images without starting |
| `just build-no-cache` | Build without Docker cache (use when changes aren't applied) |
| `just rebuild app` | Rebuild and restart a specific service without cache |
| `just enable-dev` | Enable local build mode |
| `just disable-dev` | Disable local build mode |

### Docker - Common

| Command | Description |
|---------|-------------|
| `just down` | Stop services |
| `just restart` | Restart services |
| `just logs` | View all logs |
| `just logs-api` | View API logs |
| `just logs-app` | View frontend logs |
| `just mode` | Show current mode |

### Docker - Profiles

| Command | Description |
|---------|-------------|
| `just up-oidc` | Start with Dex OIDC |
| `just up-admin` | Start with pgAdmin/MinIO Console |

### Code Checks

| Command | Description |
|---------|-------------|
| `just check-all` | Run ALL checks (frontend + backend + room) |
| `just check-frontend` | TypeScript + Prettier + ESLint |
| `just check-backend` | Build + Prettier + ESLint |
| `just check-room` | Build + Prettier + ESLint |
| `just fix-all` | Auto-fix formatting issues |

### Development

| Command | Description |
|---------|-------------|
| `just dev-frontend` | Start frontend dev server |
| `just dev-backend` | Start backend dev server |
| `just install` | Install all dependencies |

### Database

| Command | Description |
|---------|-------------|
| `just db-migrate` | Run Prisma migrations |
| `just db-generate` | Generate Prisma client |
| `just db-studio` | Open Prisma Studio |

### Git

| Command | Description |
|---------|-------------|
| `just status` | Git status for all repos |
| `just git-pull` | Pull latest from all repos |

### API Testing

| Command | Description |
|---------|-------------|
| `just test-api` | Run backend API tests (default URL: https://10.100.0.10) |
| `just test-api https://your-domain.com` | Run tests against custom URL |
| `just test-api-full URL EMAIL PASSWORD` | Run tests with custom super admin credentials |

**When to use `just test-api`:**
- After implementing backend changes
- After merging backend branch to main
- After database migrations
- Before starting frontend implementation

**Example workflow:**
```bash
just fresh-dev          # Fresh start with local builds
just test-api           # Run all API tests
# If tests pass, proceed with frontend work
```

### Setup & Release

| Command | Description |
|---------|-------------|
| `just setup` | Full setup for new developers |
| `just release-frontend 0.18.0-beta0.37` | Tag and push frontend |
| `just release-backend 0.5.3` | Tag and push backend |

## AI Usage Guidelines

### When to use which deployment command

| Scenario | Command |
|----------|---------|
| Testing a new GHCR image release | `just fresh` |
| Developing/debugging local changes | `just up-dev` or `just fresh-dev` |
| Quick restart after config change | `just restart` |
| Checking if production images work | `just up-prod` |

### Example AI Responses

❌ **Bad** (verbose):
```
cd deploy && docker compose down -v
docker volume rm astradraw_postgres_data astradraw_minio_data
cd deploy && docker compose up -d
```

✅ **Good** (concise):
```
just fresh
```

❌ **Bad**:
```
cd deploy && docker compose -f docker-compose.yml up -d
```

✅ **Good**:
```
just up-prod
```

❌ **Bad**:
```
cd frontend && yarn test:typecheck && yarn test:other && yarn test:code
cd backend && npm run build && npm run format && npm run lint
```

✅ **Good**:
```
just check-all
```

### Workflow Examples

**Testing a new feature with local builds:**
```bash
just check-all        # Run all checks first
just fresh-dev        # Fresh start with local builds
just logs-api         # Check API logs
```

**Testing production images after release:**
```bash
just disable-dev      # Ensure using production mode
just pull             # Pull latest images
just fresh            # Fresh start
```

**Switching between modes:**
```bash
just mode             # Check current mode
just enable-dev       # Switch to local builds
just up-dev           # Start with local builds
# ... test ...
just disable-dev      # Switch back to production
just up               # Start with GHCR images
```
