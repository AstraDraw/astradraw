---
description: "Git release workflow - request when merging to main, tagging releases, or updating docker-compose"
---

# Git Release Process

**For branch creation and feature development, use `/new-feature` command instead.**

This rule covers the release process after feature implementation is complete.

## Branch Naming Convention

Use descriptive `feature/` prefixes with kebab-case:

```
feature/user-profile-avatars
feature/scene-thumbnails  
feature/team-permissions
fix/jwt-cookie-refresh
refactor/storage-abstraction
```

**Same branch name in ALL affected repos** (frontend, backend, room-service).

## Commit Message Format (Important!)

**Write commits as mini-changelogs** - these will be summarized into CHANGELOG.md at release time.

Format: `type(scope): description`

```
feat(workspace): add auto-save functionality

- Added debounced save on canvas changes
- Shows save indicator in toolbar
- Handles offline/online transitions
```

```
fix(auth): resolve JWT cookie not being sent

- Added credentials: "include" to all API calls
- Fixed cookie SameSite attribute
```

**Types:** `feat:`, `fix:`, `docs:`, `refactor:`, `test:`, `chore:`

**Scopes (optional):** `workspace`, `auth`, `collab`, `ui`, `api`, `storage`

## Pre-Release Checklist

Before merging to main:
- [ ] `just check-all` passes
- [ ] Feature tested in browser at `https://draw.local`
- [ ] Existing features still work

## Step 1: Merge to Main

```bash
cd frontend && git checkout main && git merge feature/<name>
cd ../backend && git checkout main && git merge feature/<name>
cd ../room-service && git checkout main && git merge feature/<name>  # if changed
```

## Step 2: Update Changelogs (Only at Release!)

**Do NOT update changelog on every commit** - this triggers GitHub Actions builds.

**At release time**, review commits since last release and summarize:

```bash
# See commits since last tag
cd frontend && git log $(git describe --tags --abbrev=0)..HEAD --oneline
cd ../backend && git log $(git describe --tags --abbrev=0)..HEAD --oneline
```

Then add summary to CHANGELOG.md:

```markdown
## [X.Y.Z] - YYYY-MM-DD

### Added
- User profile with avatar upload
- Scene thumbnails

### Fixed
- Scene data loss when navigating
```

## Step 3: Tag Releases

```bash
cd frontend && git tag v0.18.0-beta0.XX && git push origin main --tags
cd ../backend && git tag v0.5.X && git push origin main --tags
cd ../room-service && git tag v0.1.X && git push origin main --tags  # if changed
```

## Step 4: Update Docker Compose

Update `deploy/docker-compose.yml` with new image versions:

```yaml
app:
  image: ghcr.io/astrateam-net/astradraw-app:0.18.0-beta0.XX
api:
  image: ghcr.io/astrateam-net/astradraw-api:0.5.X
room:
  image: ghcr.io/astrateam-net/astradraw-room:0.1.X  # if changed
```

## Step 5: Commit Main Repo

```bash
cd /path/to/astradraw
git add deploy/docker-compose.yml
git commit -m "chore: update images to frontend vX.X.X, backend vX.X.X"
git push origin main
```
